#!/bin/bash
SCRIPTPATH="$( cd "$(dirname "$0")" ; pwd -P )"
readarray -t REQUIRED_GPU_TYPES < ${SCRIPTPATH}/gpu_flavors.txt
readarray -t ONDEMAND_GPU_TYPES < ${SCRIPTPATH}/gpu_flavors_ondemand.txt
ALL_GPU_TYPES=( ${REQUIRED_GPU_TYPES[@]} ${ONDEMAND_GPU_TYPES[@]} )
CMSSW_VER=$CMSSW_VERSION
[ "${CMSSW_VER}" != "" ] || CMSSW_VER=${RELEASE_FORMAT}
CMSSW_MAJOR=0
CMSSW_MINOR=0
if [ "${CMSSW_VER}" != "" ] ; then
  CMSSW_MAJOR=$(echo ${CMSSW_VER} | cut -d_ -f2)
  CMSSW_MINOR=$(echo ${CMSSW_VER} | cut -d_ -f3)
fi
CMSSW_VER=$(echo x0${CMSSW_MAJOR}x0${CMSSW_MINOR} | sed -r -e 's|x[0]*([0-9][0-9])|\1|g;s|^0||')
PR_TEST_MATRIX_EXTRAS_LAB_TRACKING=12434.7
if [ "$CMSSW_VER" -ge 1500 ] ; then
  PR_TEST_MATRIX_EXTRAS_LAB_TRACKING="${PR_TEST_MATRIX_EXTRAS_LAB_TRACKING=},12834.7"
fi
PR_TEST_MATRIX_EXTRAS=1306.0,101.0,9.0,25202.0,10224.0,250202.181
if [ "$CMSSW_VER" -ge 1510 ] ; then
  PR_TEST_MATRIX_EXTRAS_GPU=17034.402,17034.403,17034.406,17034.412,17034.422,17034.423 #2025 Wfs
  PR_TEST_MATRIX_EXTRAS_GPU=${PR_TEST_MATRIX_EXTRAS_GPU},29834.402,29834.403,29834.404,29834.704,29834.751 #Phase2 Wfs
elif [ "$CMSSW_VER" -ge 1500 ] ; then
  PR_TEST_MATRIX_EXTRAS_GPU=17034.402,17034.403,17034.406,17034.412,17034.422,17034.423 #2025 Wfs
elif [ "$CMSSW_VER" -ge 1400 ] ; then
  PR_TEST_MATRIX_EXTRAS_GPU=12834.402,12834.403,12834.406,12834.412,12834.422,12834.423 #2024 Wfs
elif [ "$CMSSW_VER" -ge 1300 ] ; then
  PR_TEST_MATRIX_EXTRAS_GPU=12434.586,12434.587
else
  PR_TEST_MATRIX_EXTRAS_GPU=11634.586,11634.587
fi
if [ X"$PR_TEST_MATRIX_EXTRAS_GPU" != X"" ]; then
  for GPU_T in ${ALL_GPU_TYPES[@]} ; do
    GPU_T_UC=$(echo ${GPU_T} | tr '[a-z]' '[A-Z]')
    eval "PR_TEST_MATRIX_EXTRAS_${GPU_T_UC}=$PR_TEST_MATRIX_EXTRAS_GPU"
  done
fi
PR_TEST_MATRIX_EXTRAS_PROFILING=29834.21,13034.21
PR_TEST_MATRIX_EXTRAS_HIGH_STATS=35034.0
PR_TEST_MATRIX_EXTRAS_NANO=all
MATRIX_OPTION_PROFILING=""
VAR_PREFIX="PR_TEST_MATRIX_EXTRAS"
[ "$2" = "" ] || VAR_PREFIX="$2"
eval "echo \${${VAR_PREFIX}${1}}"
